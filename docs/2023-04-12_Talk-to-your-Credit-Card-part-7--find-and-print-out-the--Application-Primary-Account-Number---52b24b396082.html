<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Talk to your Credit Card part 7: find and print out the “Application Primary Account Number”…</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Talk to your Credit Card part 7: find and print out the “Application Primary Account Number”…</h1>
</header>
<section data-field="subtitle" class="p-summary">
In step 6 we anticipated the “find part” by visual examination of the prettyPrint response and here I’m explaining how to do this…
</section>
<section data-field="body" class="e-content">
<section name="a90e" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="8fd0" id="8fd0" class="graf graf--h3 graf--leading graf--title">Talk to your Credit Card part 7: find and print out the “Application Primary Account Number” (“PAN”) = card number</h3><p name="81dc" id="81dc" class="graf graf--p graf-after--h3">In step 6 we anticipated the “find part” by visual examination of the prettyPrint response and here I’m explaining how to do this programmatically.</p><figure name="d158" id="d158" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*JoofsM_udUrslXEgHu3SNA.png" data-width="300" data-height="497" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*JoofsM_udUrslXEgHu3SNA.png"></figure><p name="c11b" id="c11b" class="graf graf--p graf-after--figure">We are trying to find tag <em class="markup--em markup--p-em">0x54</em> (PAN) and <em class="markup--em markup--p-em">0x5f24</em> (Expiration Date) in the read response with our BER-TLV parser and if the tag is not null the tag was found and, after removing any trailing “F”s printed out (same for Expiration Date).</p><pre data-code-block-mode="2" spellcheck="false" data-code-block-lang="java" name="bf8f" id="bf8f" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">... code <span class="hljs-keyword">for</span> generating the read <span class="hljs-type">command</span><br /><span class="hljs-variable">readRecordResponse</span> <span class="hljs-operator">=</span> nfc.transceive(cmd);<br /><span class="hljs-type">byte</span>[] readRecordResponseTag5a = <span class="hljs-literal">null</span>;<br /><span class="hljs-type">byte</span>[] readRecordResponseTag5f24 = <span class="hljs-literal">null</span>;<br /><span class="hljs-keyword">if</span> (readRecordResponse != <span class="hljs-literal">null</span>) {<br />  <span class="hljs-keyword">try</span> {<br />      <span class="hljs-type">BerTlvs</span> <span class="hljs-variable">tlvsReadRecord</span> <span class="hljs-operator">=</span> parser.parse(readRecordResponse);<br />      <span class="hljs-type">BerTlv</span> <span class="hljs-variable">tag5a</span> <span class="hljs-operator">=</span> tlvsReadRecord.find(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BerTag</span>(<span class="hljs-number">0x5a</span>));<br />      <span class="hljs-keyword">if</span> (tag5a != <span class="hljs-literal">null</span>) {<br />         readRecordResponseTag5a = tag5a.getBytesValue();<br />         writeToUiAppend(<span class="hljs-string">&quot;found tag 0x5a in the readRecordResponse length: &quot;</span> + readRecordResponseTag5a.length + <span class="hljs-string">&quot; data: &quot;</span> + bytesToHexNpe(readRecordResponseTag5a));<br />      }<br />      <span class="hljs-type">BerTlv</span> <span class="hljs-variable">tag5f24</span> <span class="hljs-operator">=</span> tlvsReadRecord.find(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BerTag</span>(<span class="hljs-number">0x5f</span>, <span class="hljs-number">0x24</span>));<br />      <span class="hljs-keyword">if</span> (tag5f24 != <span class="hljs-literal">null</span>) {<br />         readRecordResponseTag5f24 = tag5f24.getBytesValue();<br />         writeToUiAppend(<span class="hljs-string">&quot;found tag 0x5f24 in the readRecordResponse length: &quot;</span> + readRecordResponseTag5f24.length + <span class="hljs-string">&quot; data: &quot;</span> + bytesToHexNpe(readRecordResponseTag5f24));<br />      }<br />      <span class="hljs-keyword">if</span> (readRecordResponseTag5a != <span class="hljs-literal">null</span>) {<br />         <span class="hljs-type">String</span> <span class="hljs-variable">readRecordPanString</span> <span class="hljs-operator">=</span> removeTrailingF(bytesToHexNpe(readRecordResponseTag5a));<br />         <span class="hljs-type">String</span> <span class="hljs-variable">readRecordExpirationDateString</span> <span class="hljs-operator">=</span> bytesToHexNpe(readRecordResponseTag5f24);<br />         writeToUiAppend(<span class="hljs-string">&quot;PAN: &quot;</span> + readRecordPanString);<br />         <span class="hljs-type">String</span> <span class="hljs-variable">expirationDateString</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Expiration date (&quot;</span> + (readRecordExpirationDateString.length() == <span class="hljs-number">4</span> ? <span class="hljs-string">&quot;YYMM): &quot;</span> : <span class="hljs-string">&quot;YYMMDD): &quot;</span>) + readRecordExpirationDateString;<br />      }<br />  } <span class="hljs-keyword">catch</span> (RuntimeException e) {<br />      System.out.println(<span class="hljs-string">&quot;Runtime Exception: &quot;</span> + e.getMessage());<br />  }<br />}</span></pre><p name="c67e" id="c67e" class="graf graf--p graf-after--pre">Of course you can search for Track 1 or Track 2 data as well but they are not available on every card I read so far.</p><p name="d283" id="d283" class="graf graf--p graf-after--p">Here is one record from my VisaCard used in previous steps:</p><pre data-code-block-mode="0" spellcheck="false" name="20ca" id="20ca" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">readRecord  command length: 5 data: 00b2031400<br>readRecord response length: 236 data: 7081e79f4701039f4681b04eeaeb38be423b4bc781eceb83755a26476bb43f98492fe49df28e1380b2b97579d0abc96099031baeb7e4620dcc1af54b67c4f876206d506fa641a3a06f4a8bf8b8f0c3aa9edc61562dd511a5efd4f7fd2fbe50020ef5bcda441d735be43cbcd08e9abbbae156c53811fe86f15201c1e84a8a7d70d9be856269b81110e230182eedf46a00a3223800cd76f0f9259d11a7d2d50ee20a5caa1b09cc77f76bc6c8b2eeb5e93c58962fa1b7a004c7b28cc25a0842635401222700509f690701af211c3b38005f24032506309f0702ffc05f280202769f4a01829f6e04207000009000<br>------------------------------------<br>70 81 E7 -- Record Template (EMV Proprietary)<br>         9F 47 01 -- ICC Public Key Exponent<br>                  03 (BINARY)<br>         9F 46 81 B0 -- ICC Public Key Certificate<br>                     4E EA EB 38 BE 42 3B 4B C7 81 EC EB 83 75 5A 26<br>                     47 6B B4 3F 98 49 2F E4 9D F2 8E 13 80 B2 B9 75<br>                     79 D0 AB C9 60 99 03 1B AE B7 E4 62 0D CC 1A F5<br>                     4B 67 C4 F8 76 20 6D 50 6F A6 41 A3 A0 6F 4A 8B<br>                     F8 B8 F0 C3 AA 9E DC 61 56 2D D5 11 A5 EF D4 F7<br>                     FD 2F BE 50 02 0E F5 BC DA 44 1D 73 5B E4 3C BC<br>                     D0 8E 9A BB BA E1 56 C5 38 11 FE 86 F1 52 01 C1<br>                     E8 4A 8A 7D 70 D9 BE 85 62 69 B8 11 10 E2 30 18<br>                     2E ED F4 6A 00 A3 22 38 00 CD 76 F0 F9 25 9D 11<br>                     A7 D2 D5 0E E2 0A 5C AA 1B 09 CC 77 F7 6B C6 C8<br>                     B2 EE B5 E9 3C 58 96 2F A1 B7 A0 04 C7 B2 8C C2 (BINARY)<br>         5A 08 -- Application Primary Account Number (PAN)<br>               42 63 54 01 22 27 00 50 (NUMERIC)<br>         9F 69 07 -- UDOL<br>                  01 AF 21 1C 3B 38 00 (BINARY)<br>         5F 24 03 -- Application Expiration Date<br>                  25 06 30 (NUMERIC)<br>         9F 07 02 -- Application Usage Control<br>                  FF C0 (BINARY)<br>         5F 28 02 -- Issuer Country Code<br>                  02 76 (NUMERIC)<br>         9F 4A 01 -- Static Data Authentication Tag List<br>                  82 (BINARY)<br>         9F 6E 04 -- Visa Low-Value Payment (VLP) Issuer Authorisation Code<br>                  20 70 00 00 (BINARY)<br>90 00 -- Command successfully executed (OK)<br>------------------------------------</span></pre><p name="fd1f" id="fd1f" class="graf graf--p graf-after--pre">The same procedure as with the MasterCard is to find the tags <em class="markup--em markup--p-em">0x5a</em> and <em class="markup--em markup--p-em">0x5f24</em> and printout the Credit Card number and the Expiration Date.</p><p name="93bd" id="93bd" class="graf graf--p graf-after--p">At this point I’m repeating my warning from the beginning:</p><h3 name="36a7" id="36a7" class="graf graf--h3 graf-after--p">Never ever send the data you got by this app from an active card over internet or email as the data may contain confidential data even if you can’t see them.</h3><p name="6705" id="6705" class="graf graf--p graf-after--h3">Here is a short example that simple “masking” of credit card numbers can be dangerous. The VisaCard responded this data when reading a file from the AFL list:</p><pre data-code-block-mode="0" spellcheck="false" name="4b02" id="4b02" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">------------------------------------<br>70 81 E7 -- Record Template (EMV Proprietary)<br>         9F 47 01 -- ICC Public Key Exponent<br>                  03 (BINARY)<br>         9F 46 81 B0 -- ICC Public Key Certificate<br>                     4E EA EB 38 BE 42 3B 4B C7 81 EC EB 83 75 5A 26<br>                     47 6B B4 3F 98 49 2F E4 9D F2 8E 13 80 B2 B9 75<br>                     79 D0 AB C9 60 99 03 1B AE B7 E4 62 0D CC 1A F5<br>                     4B 67 C4 F8 76 20 6D 50 6F A6 41 A3 A0 6F 4A 8B<br>                     F8 B8 F0 C3 AA 9E DC 61 56 2D D5 11 A5 EF D4 F7<br>                     FD 2F BE 50 02 0E F5 BC DA 44 1D 73 5B E4 3C BC<br>                     D0 8E 9A BB BA E1 56 C5 38 11 FE 86 F1 52 01 C1<br>                     E8 4A 8A 7D 70 D9 BE 85 62 69 B8 11 10 E2 30 18<br>                     2E ED F4 6A 00 A3 22 38 00 CD 76 F0 F9 25 9D 11<br>                     A7 D2 D5 0E E2 0A 5C AA 1B 09 CC 77 F7 6B C6 C8<br>                     B2 EE B5 E9 3C 58 96 2F A1 B7 A0 04 C7 B2 8C C2 (BINARY)<br>         5A 08 -- Application Primary Account Number (PAN)<br>               42 63 54 01 22 27 00 50 (NUMERIC)<br>         9F 69 07 -- UDOL<br>                  01 AF 21 1C 3B 38 00 (BINARY)<br>         5F 24 03 -- Application Expiration Date<br>                  25 06 30 (NUMERIC)<br>         9F 07 02 -- Application Usage Control<br>                  FF C0 (BINARY)<br>         5F 28 02 -- Issuer Country Code<br>                  02 76 (NUMERIC)<br>         9F 4A 01 -- Static Data Authentication Tag List<br>                  82 (BINARY)<br>         9F 6E 04 -- Visa Low-Value Payment (VLP) Issuer Authorisation Code<br>                  20 70 00 00 (BINARY)<br>90 00 -- Command successfully executed (OK)<br>------------------------------------</span></pre><p name="fb42" id="fb42" class="graf graf--p graf-after--pre">One of the tags returned is tag <em class="markup--em markup--p-em">0x9f46</em> (<strong class="markup--strong markup--p-strong">ICC Public Key Certificate</strong>). The data is encrypted but we can <strong class="markup--strong markup--p-strong">decrypt</strong> the tag value <strong class="markup--strong markup--p-strong">with public available keys</strong> to this data (code not included in this app):</p><pre data-code-block-mode="0" spellcheck="false" name="0085" id="0085" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">decryption of ICC Public Key success<br>Recovered Data Header Byte:               6a<br>Certificate Format:                       4<br>Application Pan:                          4263540122270050ffff<br>Certificate Expiration Date:              0625<br>Certificate Serial Number:                26e44b<br>...</span></pre><p name="c6ac" id="c6ac" class="graf graf--p graf-after--pre">Ups, the full credit card number and expiration date is shown in the decrypted key dump (compare it visually with the content of tags <em class="markup--em markup--p-em">0x5a</em> and <em class="markup--em markup--p-em">0x5f24</em>.</p><p name="3796" id="3796" class="graf graf--p graf-after--p">Now <strong class="markup--strong markup--p-strong">our journey ends</strong> as we get a last printout:</p><pre data-code-block-mode="0" spellcheck="false" name="1814" id="1814" class="graf graf--pre graf-after--p graf--preV2"><span class="pre--content">07 get PAN and Expiration date from tags 0x5a and 0x5f24<br>data for AID a0000000041010<br>PAN: 5375050000160110<br>Expiration date (YYMMDD): 240331</span></pre><figure name="6e1a" id="6e1a" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*5LMbfRnEca_QGmwqhQE_4A.png" data-width="300" data-height="418" src="https://cdn-images-1.medium.com/max/800/1*5LMbfRnEca_QGmwqhQE_4A.png"></figure><p name="742b" id="742b" class="graf graf--p graf-after--figure">There are a lot of improvements possible regarding the code but I tried to make the code as much readable as possible and tried to avoid any nesting of commands.</p><p name="d4ff" id="d4ff" class="graf graf--p graf-after--p">We saw so many data in tags to evaluate so now you do have a stable basis for your work. Have fun with your coding.</p><p name="4285" id="4285" class="graf graf--p graf-after--p">I’m providing a <strong class="markup--strong markup--p-strong">compiled debug-app</strong> (see the debug-release folder of the GitHub repository below) or try this direct link: <a href="https://github.com/AndroidCrypto/TalkToYourCreditCardPart7/blob/master/debug-release/app-debug.apk" data-href="https://github.com/AndroidCrypto/TalkToYourCreditCardPart7/blob/master/debug-release/app-debug.apk" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">app-debug.apk</strong></a>.</p><p name="5dd4" id="5dd4" class="graf graf--p graf-after--p graf--trailing">Find the full code of the app in my GitHub repository <strong class="markup--strong markup--p-strong">TalkToYourCreditCardPart7</strong>:<a href="https://github.com/AndroidCrypto/TalkToYourCreditCardPart7" data-href="https://github.com/AndroidCrypto/TalkToYourCreditCardPart7" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"> TalkToYourCreditCardPart7</a></p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@androidcrypto" class="p-author h-card">AndroidCrypto</a> on <a href="https://medium.com/p/52b24b396082"><time class="dt-published" datetime="2023-04-12T09:42:13.397Z">April 12, 2023</time></a>.</p><p><a href="https://medium.com/@androidcrypto/talk-to-your-credit-card-part-7-find-and-print-out-the-application-primary-account-number-52b24b396082" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on April 12, 2023.</p></footer></article></body></html>